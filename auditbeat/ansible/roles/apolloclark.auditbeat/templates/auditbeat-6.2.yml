#jinja2: trim_blocks: "true", lstrip_blocks: "true"
########################## Auditbeat Configuration #############################

# This is a reference configuration file documenting all non-deprecated options
# in comments. For a shorter configuration example that contains only the most
# common options, please see auditbeat.yml in the same directory.
#
# You can find the full configuration reference here:
# https://www.elastic.co/guide/en/beats/auditbeat/index.html



#================================ General ======================================

{% if 'name' in auditbeat_combined %}
# The name of the shipper that publishes the network data. It can be used to group
# all the transactions sent by a single shipper in the web interface.
# If this options is not defined, the hostname is used.
name: "{{ auditbeat_combined.name }}"
{% endif %}

{% if 'tags' in auditbeat_combined %}
# The tags of the shipper are included in their own field with each
# transaction published. Tags make it easy to group servers by different
# logical properties.
tags: {{ auditbeat_combined.tags | to_json }}
{% endif %}

{% if 'fields' in auditbeat_combined %}
# Optional fields that you can specify to add additional information to the
# output. Fields can be scalar values, arrays, dictionaries, or any nested
# combination of these.
fields:
  {% for key, val in auditbeat_combined.fields.items() %}
  {{ key }}: "{{ val }}"
  {% endfor %}
{% endif %}

{% if 'fields_under_root' in auditbeat_combined %}
# If this option is set to true, the custom fields are stored as top-level
# fields in the output document instead of being grouped under a fields
# sub-dictionary. Default is false.
fields_under_root: {{ auditbeat_combined.fields_under_root }}
{% endif %}

{% if 'queue' in auditbeat_combined %}
# Internal queue configuration for buffering events to be published.
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/configuring-internal-queue.html
queue:

  {% if 'mem' in auditbeat_combined.queue %}
  # Queue type by name (default 'mem')
  # The memory queue will present all available events (up to the outputs
  # bulk_max_size) to the output, the moment the output is ready to server
  # another batch of events.
  mem:

    {% if 'events' in auditbeat_combined.queue.mem %}
    # Max number of events the queue can buffer.
    events: {{ auditbeat_combined.queue.mem.events }}
    {% endif %}

    {% if 'flush' in auditbeat_combined.queue.mem %}
    flush:
      {% if 'min_events' in auditbeat_combined.queue.mem.flush %}
      # Hints the minimum number of events stored in the queue,
      # before providing a batch of events to the outputs.
      # A value of 0 (the default) ensures events are immediately available
      # to be sent to the outputs.
      min_events: {{ auditbeat_combined.queue.mem.flush.min_events }}
      {% endif %}

      {% if 'timeout' in auditbeat_combined.queue.mem.flush %}
      # Maximum duration after which events are available to the outputs,
      # if the number of events stored in the queue is < min_flush_events.
      timeout: {{ auditbeat_combined.queue.mem.flush.timeout }}
      {% endif %}
    {% endif %}
  {%- endif %}
{% endif %}

{% if 'max_procs' in auditbeat_combined %}
# Sets the maximum number of CPUs that can be executing simultaneously. The
# default is the number of logical CPUs available in the system.
max_procs: {{ auditbeat_combined.max_procs }}
{% endif %}

{% if 'max_start_delay' in auditbeat_combined %}
# Maximum amount of time to randomly delay the start of a metricset. Use 0 to
# disable startup delay.
max_start_delay: {{ auditbeat_combined.max_start_delay }}
{% endif %}



{% if 'path' in auditbeat_combined %}
#================================= Paths ======================================
path:

  {% if 'home' in auditbeat_combined.path %}
  # The home path for the beatname installation. This is the default base path
  # for all other path settings and for miscellaneous files that come with the
  # distribution (for example, the sample dashboards).
  # If not set by a CLI flag or in the configuration file, the default for the
  # home path is the location of the binary.
  home: "{{ auditbeat_combined.path.home }}"
  {% endif %}

  {% if 'config' in auditbeat_combined.path %}
  # The configuration path for the beatname installation. This is the default
  # base path for configuration files, including the main YAML configuration file
  # and the Elasticsearch template file. If not set by a CLI flag or in the
  # configuration file, the default for the configuration path is the home path.
  config: "{{ auditbeat_combined.path.config }}"
  {% endif %}

  {% if 'data' in auditbeat_combined.path %}
  # The data path for the beatname installation. This is the default base path
  # for all the files in which beatname needs to store its data. If not set by a
  # CLI flag or in the configuration file, the default for the data path is a data
  # subdirectory inside the home path.
  data: "{{ auditbeat_combined.path.data }}"
  {% endif %}

  {% if 'logs' in auditbeat_combined.path %}
  # The logs path for a beatname installation. This is the default location for
  # the Beat's log files. If not set by a CLI flag or in the configuration file,
  # the default for the logs path is a logs subdirectory inside the home path.
  logs: "{{ auditbeat_combined.path.logs }}"
  {% endif %}
{% endif %}



{% if 'config' in auditbeat_combined %}
#============================  Config Reloading ================================

# Config reloading allows to dynamically load modules. Each file which is
# monitored must contain one or multiple modules as a list.
config:
  {% if 'modules' in auditbeat_combined.config %}
  modules:

    {% if 'path' in auditbeat_combined.config.modules %}
    # Glob pattern for configuration reloading
    path: {{ auditbeat_combined.config.modules.path }}
    {% endif %}

    {% if 'reload' in auditbeat_combined.config.modules %}
    reload:
      
      {% if 'period' in auditbeat_combined.config.modules.reload %}
      # Period on which files under path should be checked for changes
      period: {{ auditbeat_combined.config.modules.reload.period }}
      {% endif %}

      {% if 'enabled' in auditbeat_combined.config.modules.reload %}
      # Set to true to enable config reloading
      enabled: {{ auditbeat_combined.config.modules.reload.enabled }}
      {% endif %}
    {% endif %}
  {% endif %}
{% endif %}



#==========================  Modules configuration =============================
auditbeat.modules:
  
{% if 'auditd' in auditbeat_combined.modules %}
#----------------------------- Auditd module -----------------------------------
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/auditbeat-module-auditd.html
#
# The auditd module collects events from the audit framework in the Linux
# kernel. You need to specify audit rules for the events that you want to audit.
- module: auditd

  {% if 'resolve_ids' in auditbeat_combined.modules.auditd %}
  resolve_ids: {{ auditbeat_combined.modules.auditd.resolve_ids }}
  {% endif %}

  {% if 'failure_mode' in auditbeat_combined.modules.auditd %}
  failure_mode: {{ auditbeat_combined.modules.auditd.failure_mode }}
  {% endif %}

  {% if 'backlog_limit' in auditbeat_combined.modules.auditd %}
  backlog_limit: {{ auditbeat_combined.modules.auditd.backlog_limit }}
  {% endif %}

  {% if 'rate_limit' in auditbeat_combined.modules.auditd %}
  rate_limit: {{ auditbeat_combined.modules.auditd.rate_limit }}
  {% endif %}

  {% if 'include_raw_message' in auditbeat_combined.modules.auditd %}
  include_raw_message: {{ auditbeat_combined.modules.auditd.include_raw_message }}
  {% endif %}

  {% if 'include_warnings' in auditbeat_combined.modules.auditd %}
  include_warnings: {{ auditbeat_combined.modules.auditd.include_warnings }}
  {% endif %}

  {% if 'audit_rules' in auditbeat_combined.modules.auditd %}
  audit_rules: |
  {% for item in auditbeat_combined.modules.auditd.audit_rules %}
    -{{ item }}
  {% endfor %}
  {% endif %}
{% endif %}

{% if 'file_integrity' in auditbeat_combined.modules %}
#----------------------------- File Integrity module -----------------------------------
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/auditbeat-module-file_integrity.html
#
# The file integrity module sends events when files are changed (created,
# updated, deleted). The events contain file metadata and hashes.
- module: file_integrity
  {% if 'paths' in auditbeat_combined.modules.file_integrity %}
  paths:
  {% for item in auditbeat_combined.modules.file_integrity.paths %}
    - {{ item }}
  {% endfor %}
  {% endif %}
  
  {% if 'exclude_files' in auditbeat_combined.modules.file_integrity and 
         auditbeat_combined.modules.file_integrity.exclude_files %}
  # List of regular expressions to filter out notifications for unwanted files.
  # Wrap in single quotes to workaround YAML escaping rules. By default no files
  # are ignored.
  exclude_files:
  {% for item in auditbeat_combined.modules.file_integrity.exclude_files %}
    - {{ item }}
  {% endfor %}
  {% endif %}

  {% if 'scan_at_start' in auditbeat_combined.modules.file_integrity %}
  # Scan over the configured file paths at startup and send events for new or
  # modified files since the last time Auditbeat was running.
  scan_at_start: {{ auditbeat_combined.modules.file_integrity.scan_at_start }}
  {% endif %}

  {% if 'scan_rate_per_sec' in auditbeat_combined.modules.file_integrity %}
  # Average scan rate. This throttles the amount of CPU and I/O that Auditbeat
  # consumes at startup while scanning. Default is "50 MiB".
  scan_rate_per_sec: {{ auditbeat_combined.modules.file_integrity.scan_rate_per_sec }}
  {% endif %}

  {% if 'max_file_size' in auditbeat_combined.modules.file_integrity %}
  # Limit on the size of files that will be hashed. Default is "100 MiB".
  # Limit on the size of files that will be hashed. Default is "100 MiB".
  max_file_size: {{ auditbeat_combined.modules.file_integrity.max_file_size }}
  {% endif %}

  {% if 'hash_types' in auditbeat_combined.modules.file_integrity %}
  # Hash types to compute when the file changes. Supported types are
  # blake2b_256, blake2b_384, blake2b_512, md5, sha1, sha224, sha256, sha384,
  # sha512, sha512_224, sha512_256, sha3_224, sha3_256, sha3_384 and sha3_512.
  # Default is sha1.
  hash_types: {{ auditbeat_combined.modules.file_integrity.hash_types }}
  {% endif %}

  {% if 'recursive' in auditbeat_combined.modules.file_integrity %}
  # Detect changes to files included in subdirectories. Disabled by default.
  recursive: {{ auditbeat_combined.modules.file_integrity.recursive }}
  {% endif %}
{% endif %}



#================================ Processors ===================================
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/defining-processors.html
#
# Processors are used to reduce the number of fields in the exported event or to
# enhance the event with external metadata. This section defines a list of
# processors that are applied one by one and the first one receives the initial
# event:
#
#   event -> filter1 -> event1 -> filter2 ->event2 ...
#
# The supported processors are drop_fields, drop_event, include_fields, and
# add_cloud_metadata.
#
# For example, you can use the following processors to keep the fields that
# contain CPU load percentages, but remove the fields that contain CPU ticks
# values:
#
#processors:
#- include_fields:
#    fields: ["cpu"]
#- drop_fields:
#    fields: ["cpu.user", "cpu.system"]
#
# The following example drops the events that have the HTTP response code 200:
#
#processors:
#- drop_event:
#    when:
#       equals:
#           http.code: 200
#
# The following example enriches each event with metadata from the cloud
# provider about the host machine. It works on EC2, GCE, DigitalOcean,
# Tencent Cloud, and Alibaba Cloud.
#
#processors:
#- add_cloud_metadata: ~
#
# The following example enriches each event with the machine's local time zone
# offset from UTC.
#
#processors:
#- add_locale:
#    format: offset
#
# The following example enriches each event with docker metadata, it matches
# given fields to an existing container id and adds info from that container:
#
#processors:
#- add_docker_metadata:
#    host: "unix:///var/run/docker.sock"
#    match_fields: ["system.process.cgroup.id"]
#    match_pids: ["process.pid", "process.ppid"]
#    match_source: true
#    match_source_index: 4
#    cleanup_timeout: 60
#    # To connect to Docker over TLS you must specify a client and CA certificate.
#    #ssl:
#    #  certificate_authority: "/etc/pki/root/ca.pem"
#    #  certificate:           "/etc/pki/client/cert.pem"
#    #  key:                   "/etc/pki/client/cert.key"
#
# The following example enriches each event with docker metadata, it matches
# container id from log path available in `source` field (by default it expects
# it to be /var/lib/docker/containers/*/*.log).
#
#processors:
#- add_docker_metadata: ~



#============================= Elastic Cloud ==================================

# These settings simplify using beatname with the Elastic Cloud (https://cloud.elastic.co/).

# The cloud.id setting overwrites the `output.elasticsearch.hosts` and
# `setup.kibana.host` options.
# You can find the `cloud.id` in the Elastic Cloud web UI.
#cloud.id:

# The cloud.auth setting overwrites the `output.elasticsearch.username` and
# `output.elasticsearch.password` settings. The format is `<user>:<pass>`.
#cloud.auth:



#================================ Outputs ======================================
#
# Configure what output to use when sending the data collected by the beat.
#
{% if 'elasticsearch' in auditbeat_combined.output and 
   auditbeat_combined.output.elasticsearch %}
#-------------------------- Elasticsearch output -------------------------------
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/elasticsearch-output.html
#
output.elasticsearch:
  
  {% if 'enabled' in auditbeat_combined.output.elasticsearch %}
  # Boolean flag to enable or disable the output module.
  enabled: {{ auditbeat_combined.output.elasticsearch.enabled }}
  {% endif %}

  {% if 'hosts' in auditbeat_combined.output.elasticsearch %}
  # Array of hosts to connect to.
  # Scheme and port can be left out and will be set to the default (http and 9200)
  # In case you specify and additional path, the scheme is required: http://localhost:9200/path
  # IPv6 addresses should always be defined as: https://[2001:db8::1]:9200
  hosts:
  {% for item in auditbeat_combined.output.elasticsearch.hosts %}
    - {{ item }}
  {% endfor %}
  {% endif %}

  {% if 'compression_level' in auditbeat_combined.output.elasticsearch %}
  # Set gzip compression level.
  compression_level: {{ auditbeat_combined.output.elasticsearch.compression_level }}
  {% endif %}

  {% if 'protocol' in auditbeat_combined.output.elasticsearch %}
  # Optional protocol and basic auth credentials.
  protocol: "{{ auditbeat_combined.output.elasticsearch.protocol }}"
  {% endif %}

  {% if 'username' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.username %}
  username: "{{ auditbeat_combined.output.elasticsearch.username }}"
  {% endif %}

  {% if 'password' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.password %}
  password: "{{ auditbeat_combined.output.elasticsearch.password }}"
  {% endif %}

  {% if 'parameters' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.parameters %}
  # Dictionary of HTTP parameters to pass within the url with index operations.
  parameters:
    - param1: value1
  {% endif %}

  {% if 'worker' in auditbeat_combined.output.elasticsearch %}
  # Number of workers per Elasticsearch host.
  worker: {{ auditbeat_combined.output.elasticsearch.worker }}
  {% endif %}

  {% if 'index' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.index %}
  # Optional index name. The default is "beat-index-prefix" plus date
  # and generates [beat-index-prefix-]YYYY.MM.DD keys.
  # In case you modify this pattern you must update setup.template.name and setup.template.pattern accordingly.
  index: "{{ auditbeat_combined.output.elasticsearch.index }}"
  {% endif %}

  {% if 'indices' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.indices %}
  # Array of hosts to connect to.
  # Scheme and port can be left out and will be set to the default (http and 9200)
  # In case you specify and additional path, the scheme is required: http://localhost:9200/path
  # IPv6 addresses should always be defined as: https://[2001:db8::1]:9200
  indices:
  {% for item in auditbeat_combined.output.elasticsearch.indices %}
    - {{ item }}
  {% endfor %}
  {% endif %}

  {% if 'pipeline' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.pipeline %}
  # Optional ingest node pipeline. By default no pipeline will be used.
  pipeline: "{{ auditbeat_combined.output.elasticsearch.pipeline }}"
  {% endif %}

  {% if 'pipelines' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.pipelines %}
  # Optional ingest node pipeline. By default no pipeline will be used.
  pipelines: "{{ auditbeat_combined.output.elasticsearch.pipelines }}"
  {% endif %}

  {% if 'path' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.path %}
  # Optional HTTP Path
  path: "{{ auditbeat_combined.output.elasticsearch.path }}"
  {% endif %}

  {% if 'headers' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.headers %}
  # Custom HTTP headers to add to each request
  headers:
    - X-My-Header: Contents of the header
  {% endif %}

  {% if 'proxy_url' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.proxy_url %}
  # Proxy server url
  proxy_url: "{{ auditbeat_combined.output.elasticsearch.proxy_url }}"
  {% endif %}

  {% if 'max_retries' in auditbeat_combined.output.elasticsearch %}
  # The number of times a particular Elasticsearch index operation is attempted. If
  # the indexing operation doesn't succeed after this many retries, the events are
  # dropped. The default is 3.
  max_retries: {{ auditbeat_combined.output.elasticsearch.max_retries }}
  {% endif %}

  {% if 'bulk_max_size' in auditbeat_combined.output.elasticsearch %}
  # The maximum number of events to bulk in a single Elasticsearch bulk API index request.
  # The default is 50.
  bulk_max_size: {{ auditbeat_combined.output.elasticsearch.bulk_max_size }}
  {% endif %}

  {% if 'timeout' in auditbeat_combined.output.elasticsearch %}
  # Configure http request timeout before failing an request to Elasticsearch.
  timeout: {{ auditbeat_combined.output.elasticsearch.timeout }}
  {% endif %}

  {% if 'ssl' in auditbeat_combined.output.elasticsearch and 
         auditbeat_combined.output.elasticsearch.ssl %}
  # Use SSL settings for HTTPS.
  #ssl:
    #enabled: true

    # Configure SSL verification mode. If `none` is configured, all server hosts
    # and certificates will be accepted. In this mode, SSL based connections are
    # susceptible to man-in-the-middle attacks. Use only for testing. Default is
    # `full`.
    #verification_mode: full

    # List of supported/valid TLS versions. By default all TLS versions 1.0 up to
    # 1.2 are enabled.
    #supported_protocols: [TLSv1.0, TLSv1.1, TLSv1.2]
  
    # SSL configuration. By default is off.
    # List of root certificates for HTTPS server verifications
    #certificate_authorities: ["/etc/pki/root/ca.pem"]
  
    # Certificate for SSL client authentication
    #certificate: "/etc/pki/client/cert.pem"
  
    # Client Certificate Key
    #key: "/etc/pki/client/cert.key"
  
    # Optional passphrase for decrypting the Certificate Key.
    #key_passphrase: ''
  
    # Configure cipher suites to be used for SSL connections
    #cipher_suites: []
  
    # Configure curve types for ECDHE based cipher suites
    #curve_types: []
  
    # Configure what types of renegotiation are supported. Valid options are
    # never, once, and freely. Default is never.
    #renegotiation: never
  {% endif %}
{% endif %}

{% if 'logstash' in auditbeat_combined.output and 
   auditbeat_combined.output.logstash %}
#----------------------------- Logstash output ---------------------------------
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/logstash-output.html
#
output.logstash:
  
  {% if 'enabled' in auditbeat_combined.output.logstash %}
  # Boolean flag to enable or disable the output module.
  enabled: {{ auditbeat_combined.output.logstash.enabled }}
  {% endif %}

  {% if 'hosts' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.hosts %}
  # The Logstash hosts
  hosts:
  {% for item in auditbeat_combined.output.logstash.hosts %}
    - {{ item }}
  {% endfor %}
  {% endif %}

  {% if 'worker' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.worker %}
  # Number of workers per Logstash host.
  worker: {{ auditbeat_combined.output.logstash.worker }}
  {% endif %}

  {% if 'compression_level' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.compression_level %}
  # Set gzip compression level.
  compression_level: {{ auditbeat_combined.output.logstash.compression_level }}
  {% endif %}

  {% if 'ttl' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.ttl %}
  # Optional maximum time to live for a connection to Logstash, after which the
  # connection will be re-established.  A value of `0s` (the default) will
  # disable this feature.
  #
  # Not yet supported for async connections (i.e. with the "pipelining" option set)
  ttl: {{ auditbeat_combined.output.logstash.ttl }}
  {% endif %}

  {% if 'loadbalance' in auditbeat_combined.output.logstash %}
  # Optional load balance the events between the Logstash hosts. Default is false.
  loadbalance: {{ auditbeat_combined.output.logstash.loadbalance }}
  {% endif %}

  {% if 'pipelining' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.pipelining %}
  # Number of batches to be sent asynchronously to logstash while processing
  # new batches.
  pipelining: {{ auditbeat_combined.output.logstash.pipelining }}
  {% endif %}

  {% if 'slow_start' in auditbeat_combined.output.logstash %}
  # If enabled only a subset of events in a batch of events is transferred per
  # transaction.  The number of events to be sent increases up to `bulk_max_size`
  # if no error is encountered.
  slow_start: {{ auditbeat_combined.output.logstash.slow_start }}
  {% endif %}

  {% if 'index' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.index %}
  # Optional index name. The default index name is set to beat-index-prefix
  # in all lowercase.
  index: "{{ auditbeat_combined.output.logstash.index }}"
  {% endif %}

  {% if 'proxy_url' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.proxy_url %}
  # SOCKS5 proxy server URL
  proxy_url: "{{ auditbeat_combined.output.logstash.proxy_url }}"
  {% endif %}

  {% if 'proxy_use_local_resolver' in auditbeat_combined.output.logstash %}
  # Resolve names locally when using a proxy server. Defaults to false.
  proxy_use_local_resolver: {{ auditbeat_combined.output.logstash.proxy_use_local_resolver }}
  {% endif %}

  {% if 'ssl' in auditbeat_combined.output.logstash and 
         auditbeat_combined.output.logstash.ssl %}
  # Enable SSL support. SSL is automatically enabled, if any SSL setting is set.
  #ssl:
    #enabled: true

    # Configure SSL verification mode. If `none` is configured, all server hosts
    # and certificates will be accepted. In this mode, SSL based connections are
    # susceptible to man-in-the-middle attacks. Use only for testing. Default is
    # `full`.
    #verification_mode: full
  
    # List of supported/valid TLS versions. By default all TLS versions 1.0 up to
    # 1.2 are enabled.
    #supported_protocols: [TLSv1.0, TLSv1.1, TLSv1.2]
  
    # Optional SSL configuration options. SSL is off by default.
    # List of root certificates for HTTPS server verifications
    #certificate_authorities: ["/etc/pki/root/ca.pem"]
  
    # Certificate for SSL client authentication
    #certificate: "/etc/pki/client/cert.pem"
  
    # Client Certificate Key
    #key: "/etc/pki/client/cert.key"
  
    # Optional passphrase for decrypting the Certificate Key.
    #key_passphrase: ''
  
    # Configure cipher suites to be used for SSL connections
    #cipher_suites: []
  
    # Configure curve types for ECDHE based cipher suites
    #curve_types: []
  
    # Configure what types of renegotiation are supported. Valid options are
    # never, once, and freely. Default is never.
    #renegotiation: never
  {% endif %}
{% endif %}

#------------------------------- Kafka output ----------------------------------
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/kafka-output.html
#
output.kafka:

  {% if 'enabled' in auditbeat_combined.output.kafka %}
  # Boolean flag to enable or disable the output module.
  enabled: {{ auditbeat_combined.output.kafka.enabled }}
  {% endif %}

  {% if 'hosts' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.hosts %}
  # The list of Kafka broker addresses from where to fetch the cluster metadata.
  # The cluster metadata contain the actual Kafka brokers events are published
  # to.
  hosts:
  {% for item in auditbeat_combined.output.kafka.hosts %}
    - {{ item }}
  {% endfor %}
  {% endif %}

  {% if 'topic' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.topic %}
  # The Kafka topic used for produced events. The setting can be a format string
  # using any event field. To set the topic from document type use `%{[type]}`.
  topic: '{{ auditbeat_combined.output.kafka.topic }}'
  {% endif %}

  {% if 'key' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.key %}
  # The Kafka event key setting. Use format string to create unique event key.
  # By default no event key will be generated.
  key: '{{ auditbeat_combined.output.kafka.key }}'
  {% endif %}

  {% if 'partition' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.partition %}
  # The Kafka event partitioning strategy. Default hashing strategy is `hash`
  # using the `output.kafka.key` setting or randomly distributes events if
  # `output.kafka.key` is not configured.
  partition:

    {% if 'hash' in auditbeat_combined.output.kafka.partition and 
       auditbeat_combined.output.kafka.partition.hash %}
    hash:

      {% if 'reachable_only' in auditbeat_combined.output.kafka.partition.hash %}
      # If enabled, events will only be published to partitions with reachable
      # leaders. Default is false.
      reachable_only: {{ auditbeat_combined.output.kafka.partition.hash.reachable_only }}
      {% endif %}
  
      {% if 'key' in auditbeat_combined.output.kafka.partition.hash and 
         auditbeat_combined.output.kafka.partition.hash.hash %}
      # Configure alternative event field names used to compute the hash value.
      # If empty `output.kafka.key` setting will be used.
      # Default value is empty list.
      hash: {{ auditbeat_combined.output.kafka.partition.hash.hash }}
      {% endif %}
    {% endif %}
  {% endif %}

  # Authentication details. Password is required if username is set.
  {% if 'username' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.username %}
  username: '{{ auditbeat_combined.output.kafka.username }}'
  {% endif %}

  {% if 'password' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.password %}
  password: '{{ auditbeat_combined.output.kafka.password }}'
  {% endif %}

  {% if 'version' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.version %}
  # Kafka version beatname is assumed to run against. Defaults to the oldest
  # supported stable version (currently version 0.8.2.0)
  version: {{ auditbeat_combined.output.kafka.version }}
  {% endif %}

  {% if 'metadata' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.metadata %}
  # Metadata update configuration. Metadata do contain leader information
  # deciding which broker to use when publishing.
  metadata:

    {% if 'retry' in auditbeat_combined.output.kafka.metadata and 
       auditbeat_combined.output.kafka.metadata.retry %}
    retry:
      {% if 'max' in auditbeat_combined.output.kafka.metadata.retry and 
         auditbeat_combined.output.kafka.metadata.retry.max %}
      # Max metadata request retry attempts when cluster is in middle of leader
      # election. Defaults to 3 retries.
      max: {{ auditbeat_combined.output.kafka.metadata.retry.max }}
      {% endif %}

      {% if 'backoff' in auditbeat_combined.output.kafka.metadata.retry and 
         auditbeat_combined.output.kafka.metadata.retry.backoff %}
      # Waiting time between retries during leader elections. Default is 250ms.
      backoff: {{ auditbeat_combined.output.kafka.metadata.retry.backoff }}
      {% endif %}
    {% endif %}
  
    {% if 'refresh_frequency' in auditbeat_combined.output.kafka.metadata.retry and 
       auditbeat_combined.output.kafka.metadata.retry.refresh_frequency %}
    # Refresh metadata interval. Defaults to every 10 minutes.
    refresh_frequency: {{ auditbeat_combined.output.kafka.metadata.retry.refresh_frequency }}
    {% endif %}
  {% endif %}

  {% if 'worker' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.worker %}
  # The number of concurrent load-balanced Kafka output workers.
  worker: {{ auditbeat_combined.output.kafka.worker }}
  {% endif %}

  {% if 'max_retries' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.max_retries %}
  # The number of times to retry publishing an event after a publishing failure.
  # After the specified number of retries, the events are typically dropped.
  # Some Beats, such as Filebeat, ignore the max_retries setting and retry until
  # all events are published.  Set max_retries to a value less than 0 to retry
  # until all events are published. The default is 3.
  max_retries: {{ auditbeat_combined.output.kafka.max_retries }}
  {% endif %}

  {% if 'bulk_max_size' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.bulk_max_size %}
  # The maximum number of events to bulk in a single Kafka request. The default
  # is 2048.
  bulk_max_size: {{ auditbeat_combined.output.kafka.bulk_max_size }}
  {% endif %}

  {% if 'timeout' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.timeout %}
  # The number of seconds to wait for responses from the Kafka brokers before
  # timing out. The default is 30s.
  timeout: {{ auditbeat_combined.output.kafka.timeout }}
  {% endif %}

  {% if 'broker_timeout' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.broker_timeout %}
  # The maximum duration a broker will wait for number of required ACKs. The
  # default is 10s.
  broker_timeout: {{ auditbeat_combined.output.kafka.broker_timeout }}
  {% endif %}

  {% if 'channel_buffer_size' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.channel_buffer_size %}
  # The number of messages buffered for each Kafka broker. The default is 256.
  channel_buffer_size: {{ auditbeat_combined.output.kafka.channel_buffer_size }}
  {% endif %}

  {% if 'keep_alive' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.keep_alive %}
  # The keep-alive period for an active network connection. If 0s, keep-alives
  # are disabled. The default is 0 seconds.
  keep_alive: {{ auditbeat_combined.output.kafka.keep_alive }}
  {% endif %}

  {% if 'compression' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.compression %}
  # Sets the output compression codec. Must be one of none, snappy and gzip. The
  # default is gzip.
  compression: {{ auditbeat_combined.output.kafka.compression }}
  {% endif %}

  {% if 'max_message_bytes' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.max_message_bytes %}
  # The maximum permitted size of JSON-encoded messages. Bigger messages will be
  # dropped. The default value is 1000000 (bytes). This value should be equal to
  # or less than the broker's message.max.bytes.
  max_message_bytes: {{ auditbeat_combined.output.kafka.max_message_bytes }}
  {% endif %}

  {% if 'required_acks' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.required_acks %}
  # The ACK reliability level required from broker. 0=no response, 1=wait for
  # local commit, -1=wait for all replicas to commit. The default is 1.  Note:
  # If set to 0, no ACKs are returned by Kafka. Messages might be lost silently
  # on error.
  required_acks: {{ auditbeat_combined.output.kafka.required_acks }}
  {% endif %}

  {% if 'client_id' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.client_id %}
  # The configurable ClientID used for logging, debugging, and auditing
  # purposes.  The default is "beats".
  client_id: "{{ auditbeat_combined.output.kafka.client_id }}"
  {% endif %}

  {% if 'ssl' in auditbeat_combined.output.kafka and 
     auditbeat_combined.output.kafka.ssl %}
  # Enable SSL support. SSL is automatically enabled, if any SSL setting is set.
  #ssl:
    #enabled: true
  
    # Optional SSL configuration options. SSL is off by default.
    # List of root certificates for HTTPS server verifications
    #certificate_authorities: ["/etc/pki/root/ca.pem"]
  
    # Configure SSL verification mode. If `none` is configured, all server hosts
    # and certificates will be accepted. In this mode, SSL based connections are
    # susceptible to man-in-the-middle attacks. Use only for testing. Default is
    # `full`.
    #verification_mode: full
  
    # List of supported/valid TLS versions. By default all TLS versions 1.0 up to
    # 1.2 are enabled.
    #supported_protocols: [TLSv1.0, TLSv1.1, TLSv1.2]
  
    # Certificate for SSL client authentication
    #certificate: "/etc/pki/client/cert.pem"
  
    # Client Certificate Key
    #key: "/etc/pki/client/cert.key"
  
    # Optional passphrase for decrypting the Certificate Key.
    #key_passphrase: ''
  
    # Configure cipher suites to be used for SSL connections
    #cipher_suites: []
  
    # Configure curve types for ECDHE based cipher suites
    #curve_types: []
  
    # Configure what types of renegotiation are supported. Valid options are
    # never, once, and freely. Default is never.
    #renegotiation: never
  {% endif %}
{% endif %}

#------------------------------- Redis output ----------------------------------
#output.redis:
  # Boolean flag to enable or disable the output module.
  #enabled: true

  # The list of Redis servers to connect to. If load balancing is enabled, the
  # events are distributed to the servers in the list. If one server becomes
  # unreachable, the events are distributed to the reachable servers only.
  #hosts: ["localhost:6379"]

  # The Redis port to use if hosts does not contain a port number. The default
  # is 6379.
  #port: 6379

  # The name of the Redis list or channel the events are published to. The
  # default is beatname.
  #key: beatname

  # The password to authenticate with. The default is no authentication.
  #password:

  # The Redis database number where the events are published. The default is 0.
  #db: 0

  # The Redis data type to use for publishing events. If the data type is list,
  # the Redis RPUSH command is used. If the data type is channel, the Redis
  # PUBLISH command is used. The default value is list.
  #datatype: list

  # The number of workers to use for each host configured to publish events to
  # Redis. Use this setting along with the loadbalance option. For example, if
  # you have 2 hosts and 3 workers, in total 6 workers are started (3 for each
  # host).
  #worker: 1

  # If set to true and multiple hosts or workers are configured, the output
  # plugin load balances published events onto all Redis hosts. If set to false,
  # the output plugin sends all events to only one host (determined at random)
  # and will switch to another host if the currently selected one becomes
  # unreachable. The default value is true.
  #loadbalance: true

  # The Redis connection timeout in seconds. The default is 5 seconds.
  #timeout: 5s

  # The number of times to retry publishing an event after a publishing failure.
  # After the specified number of retries, the events are typically dropped.
  # Some Beats, such as Filebeat, ignore the max_retries setting and retry until
  # all events are published. Set max_retries to a value less than 0 to retry
  # until all events are published. The default is 3.
  #max_retries: 3

  # The maximum number of events to bulk in a single Redis request or pipeline.
  # The default is 2048.
  #bulk_max_size: 2048

  # The URL of the SOCKS5 proxy to use when connecting to the Redis servers. The
  # value must be a URL with a scheme of socks5://.
  #proxy_url:

  # This option determines whether Redis hostnames are resolved locally when
  # using a proxy. The default value is false, which means that name resolution
  # occurs on the proxy server.
  #proxy_use_local_resolver: false

  # Enable SSL support. SSL is automatically enabled, if any SSL setting is set.
  #ssl:
    #enabled: false
  
    # Configure SSL verification mode. If `none` is configured, all server hosts
    # and certificates will be accepted. In this mode, SSL based connections are
    # susceptible to man-in-the-middle attacks. Use only for testing. Default is
    # `full`.
    #verification_mode: full
  
    # List of supported/valid TLS versions. By default all TLS versions 1.0 up to
    # 1.2 are enabled.
    #supported_protocols: [TLSv1.0, TLSv1.1, TLSv1.2]
  
    # Optional SSL configuration options. SSL is off by default.
    # List of root certificates for HTTPS server verifications
    #certificate_authorities: ["/etc/pki/root/ca.pem"]
  
    # Certificate for SSL client authentication
    #certificate: "/etc/pki/client/cert.pem"
  
    # Client Certificate Key
    #key: "/etc/pki/client/cert.key"
  
    # Optional passphrase for decrypting the Certificate Key.
    #key_passphrase: ''
  
    # Configure cipher suites to be used for SSL connections
    #cipher_suites: []
  
    # Configure curve types for ECDHE based cipher suites
    #curve_types: []
  
    # Configure what types of renegotiation are supported. Valid options are
    # never, once, and freely. Default is never.
    #renegotiation: never

#------------------------------- File output -----------------------------------
#output.file:
  # Boolean flag to enable or disable the output module.
  #enabled: true

  # Path to the directory where to save the generated files. The option is
  # mandatory.
  #path: "/tmp/beatname"

  # Name of the generated files. The default is `beatname` and it generates
  # files: `beatname`, `beatname.1`, `beatname.2`, etc.
  #filename: beatname

  # Maximum size in kilobytes of each file. When this size is reached, and on
  # every beatname restart, the files are rotated. The default value is 10240
  # kB.
  #rotate_every_kb: 10000

  # Maximum number of files under path. When this number of files is reached,
  # the oldest file is deleted and the rest are shifted from last to first. The
  # default is 7 files.
  #number_of_files: 7

  # Permissions to use for file creation. The default is 0600.
  #permissions: 0600

#----------------------------- Console output ---------------------------------
#output.console:
  # Boolean flag to enable or disable the output module.
  #enabled: true

  # Pretty print json event
  #pretty: false



{% if 'dashboards' in auditbeat_combined.setup and 
   auditbeat_combined.setup.dashboards %}
#============================== Dashboards =====================================
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/configuration-dashboards.html
#
# These settings control loading the sample dashboards to the Kibana index. Loading
# the dashboards are disabled by default and can be enabled either by setting the
# options here, or by using the `-setup` CLI flag or the `setup` command.
setup.dashboards:

  {% if 'enabled' in auditbeat_combined.setup.dashboards %}
  enabled: {{ auditbeat_combined.setup.dashboards.enabled }}
  {% endif %}

  {% if 'directory' in auditbeat_combined.setup.dashboards and 
         auditbeat_combined.setup.dashboards.directory %}
  # The directory from where to read the dashboards. The default is the `kibana`
  # folder in the home path.
  directory: {{ auditbeat_combined.setup.dashboards.directory }}
  {% endif %}

  {% if 'url' in auditbeat_combined.setup.dashboards and 
         auditbeat_combined.setup.dashboards.url %}
  # The URL from where to download the dashboards archive. It is used instead of
  # the directory if it has a value.
  url: "{{ auditbeat_combined.setup.dashboards.url }}"
  {% endif %}

  {% if 'file' in auditbeat_combined.setup.dashboards and 
        auditbeat_combined.setup.dashboards.file %}
  # The  file archive (zip file) from where to read the dashboards. It is used instead
  # of the directory when it has a value.
  file: "{{ auditbeat_combined.setup.dashboards.file }}"
  {% endif %}

  {% if 'beat' in auditbeat_combined.setup.dashboards and 
      auditbeat_combined.setup.dashboards.beat %}
  # In case the archive contains the dashboards from multiple Beats, this lets you
  # select which one to load. You can load all the dashboards in the archive by
  # setting this to the empty string.
  beat: "{{ auditbeat_combined.setup.dashboards.beat }}"
  {% endif %}

  {% if 'kibana_index' in auditbeat_combined.setup.dashboards and 
         auditbeat_combined.setup.dashboards.kibana_index %}
  # The name of the Kibana index to use for setting the configuration. Default is ".kibana"
  kibana_index: "{{ auditbeat_combined.setup.dashboards.kibana_index }}"
  {% endif %}

  {% if 'index' in auditbeat_combined.setup.dashboards and 
         auditbeat_combined.setup.dashboards.index %}
  # The Elasticsearch index name. This overwrites the index name defined in the
  # dashboards and index pattern. Example: testbeat-*
  index: "{{ auditbeat_combined.setup.dashboards.index }}"
  {% endif %}

  {% if 'always_kibana' in auditbeat_combined.setup.dashboards %}
  # Always use the Kibana API for loading the dashboards instead of autodetecting
  # how to install the dashboards by first querying Elasticsearch.
  always_kibana: {{ auditbeat_combined.setup.dashboards.always_kibana }}
  {% endif %}
{% endif %}



#============================== Template =====================================
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/configuration-template.html#configuration-template
#

# A template is used to set the mapping in Elasticsearch
# By default template loading is enabled and the template is loaded.
# These settings can be adjusted to load your own template or overwrite existing ones.

# Set to false to disable template loading.
#setup.template.enabled: true

# Template name. By default the template name is "beat-index-prefix-%{[beat.version]}"
# The template name and pattern has to be set in case the elasticsearch index pattern is modified.
#setup.template.name: "beat-index-prefix-%{[beat.version]}"

# Template pattern. By default the template pattern is "-%{[beat.version]}-*" to apply to the default index settings.
# The first part is the version of the beat and then -* is used to match all daily indices.
# The template name and pattern has to be set in case the elasticsearch index pattern is modified.
#setup.template.pattern: "beat-index-prefix-%{[beat.version]}-*"

# Path to fields.yml file to generate the template
#setup.template.fields: "${path.config}/fields.yml"

# Overwrite existing template
#setup.template.overwrite: false

# Elasticsearch template settings
# setup.template.settings:

  # A dictionary of settings to place into the settings.index dictionary
  # of the Elasticsearch template. For more details, please check
  # https://www.elastic.co/guide/en/elasticsearch/reference/6.2/mapping.html
  #index:
    #number_of_shards: 1
    #codec: best_compression
    #number_of_routing_shards: 30

  # A dictionary of settings for the _source field. For more details, please check
  # https://www.elastic.co/guide/en/elasticsearch/reference/6.2/mapping-source-field.html
  #_source:
    #enabled: false



{% if 'kibana' in auditbeat_combined.setup and 
   auditbeat_combined.setup.kibana %}
#============================== Kibana =====================================

# Starting with Beats version 6.0.0, the dashboards are loaded via the Kibana API.
# This requires a Kibana endpoint configuration.
setup.kibana:

  {% if 'host' in auditbeat_combined.setup.kibana and 
         auditbeat_combined.setup.kibana.host %}
  # Kibana Host
  # Scheme and port can be left out and will be set to the default (http and 5601)
  # In case you specify and additional path, the scheme is required: http://localhost:5601/path
  # IPv6 addresses should always be defined as: https://[2001:db8::1]:5601
  host: "{{ auditbeat_combined.setup.kibana.host }}"
  {% endif %}

  {% if 'protocol' in auditbeat_combined.setup.kibana and 
         auditbeat_combined.setup.kibana.protocol %}
  # Optional protocol and basic auth credentials.
  protocol: "{{ auditbeat_combined.setup.kibana.protocol }}"
  {% endif %}

  {% if 'username' in auditbeat_combined.setup.kibana and 
         auditbeat_combined.setup.kibana.username %}
  username: "{{ auditbeat_combined.setup.kibana.username }}"
  {% endif %}

  {% if 'password' in auditbeat_combined.setup.kibana and 
         auditbeat_combined.setup.kibana.password %}
  password: "{{ auditbeat_combined.setup.kibana.password }}"
  {% endif %}

  {% if 'path' in auditbeat_combined.setup.kibana and 
         auditbeat_combined.setup.kibana.path %}
  # Optional HTTP Path
  path: "{{ auditbeat_combined.setup.kibana.path }}"
  {% endif %}

  {% if 'ssl' in auditbeat_combined.setup.kibana and 
         auditbeat_combined.setup.kibana.ssl %}
  # Use SSL settings for HTTPS. Default is true.
  #ssl:
    #enabled: true

    # Configure SSL verification mode. If `none` is configured, all server hosts
    # and certificates will be accepted. In this mode, SSL based connections are
    # susceptible to man-in-the-middle attacks. Use only for testing. Default is
    # `full`.
    #verification_mode: full
  
    # List of supported/valid TLS versions. By default all TLS versions 1.0 up to
    # 1.2 are enabled.
    #supported_protocols: [TLSv1.0, TLSv1.1, TLSv1.2]
  
    # SSL configuration. By default is off.
    # List of root certificates for HTTPS server verifications
    #certificate_authorities: ["/etc/pki/root/ca.pem"]
  
    # Certificate for SSL client authentication
    #certificate: "/etc/pki/client/cert.pem"
  
    # Client Certificate Key
    #key: "/etc/pki/client/cert.key"
  
    # Optional passphrase for decrypting the Certificate Key.
    #key_passphrase: ''
  
    # Configure cipher suites to be used for SSL connections
    #cipher_suites: []
  
    # Configure curve types for ECDHE based cipher suites
    #curve_types: []
  {% endif %}
{% endif %}



{% if 'logging' in auditbeat_combined and 
   auditbeat_combined.logging %}
#================================ Logging ======================================
# There are four options for the log output: file, stderr, syslog, eventlog
# The file output is the default.
logging:

  {% if 'level' in auditbeat_combined.logging and 
         auditbeat_combined.logging.level %}
  # Sets log level. The default log level is info.
  # Available log levels are: error, warning, info, debug
  level: "{{ auditbeat_combined.logging.level }}"
  {% endif %}

  {% if 'selectors' in auditbeat_combined.logging and 
         auditbeat_combined.logging.selectors %}
  # Enable debug output for selected components. To enable all selectors use ["*"]
  # Other available selectors are "beat", "publish", "service"
  # Multiple selectors can be chained.
  selectors: {{ auditbeat_combined.logging.selectors }}
  {% endif %}

  {% if 'to_syslog' in auditbeat_combined.logging %}
  # Send all logging output to syslog. The default is false.
  to_syslog: {{ auditbeat_combined.logging.to_syslog }}
  {% endif %}

  {% if 'to_eventlog' in auditbeat_combined.logging %}
  # Send all logging output to Windows Event Logs. The default is false.
  to_eventlog: {{ auditbeat_combined.logging.to_eventlog }}
  {% endif %}

  {% if 'metrics' in auditbeat_combined.logging and 
         auditbeat_combined.logging.metrics %}
  # If enabled, beatname periodically logs its internal metrics that have changed
  # in the last period. For each metric that changed, the delta from the value at
  # the beginning of the period is logged. Also, the total values for
  # all non-zero internal metrics are logged on shutdown. The default is true.
  metrics:

    {% if 'enabled' in auditbeat_combined.logging.metrics %}
    enabled: {{ auditbeat_combined.logging.metrics.enabled }}
    {% endif %}

    {% if 'period' in auditbeat_combined.logging.metrics and 
           auditbeat_combined.logging.metrics.period %}
    # The period after which to log the internal metrics. The default is 30s.
    period: {{ auditbeat_combined.logging.metrics.period }}
    {% endif %}
  {% endif %}
  
  {% if 'to_files' in auditbeat_combined.logging %}
  # Logging to rotating files. Set to_files to false to disable logging to
  # files.
  to_files: {{ auditbeat_combined.logging.to_files }}
  {% endif %}
  
  {% if 'files' in auditbeat_combined.logging and 
         auditbeat_combined.logging.files %}
  files:

    {% if 'path' in auditbeat_combined.logging.files and 
       auditbeat_combined.logging.files.path %}
    # Configure the path where the logs are written. The default is the logs directory
    # under the home path (the binary location).
    path: {{ auditbeat_combined.logging.files.path }}
    {% endif %}
  
    {% if 'name' in auditbeat_combined.logging.files and 
       auditbeat_combined.logging.files.name %}
    # The name of the files where the logs are written to.
    name: "{{ auditbeat_combined.logging.files.name }}"
    {% endif %}
  
    {% if 'rotateeverybytes' in auditbeat_combined.logging.files and 
       auditbeat_combined.logging.files.rotateeverybytes %}
    # Configure log file size limit. If limit is reached, log file will be
    # automatically rotated
    rotateeverybytes: {{ auditbeat_combined.logging.files.rotateeverybytes }}
    {% endif %}
  
    {% if 'keepfiles' in auditbeat_combined.logging.files and 
       auditbeat_combined.logging.files.keepfiles %}
    # Number of rotated log files to keep. Oldest files will be deleted first.
    keepfiles: {{ auditbeat_combined.logging.files.keepfiles }}
    {% endif %}
  
    {% if 'permissions' in auditbeat_combined.logging.files and 
       auditbeat_combined.logging.files.permissions %}
    # The permissions mask to apply when rotating log files. The default value is 0600.
    # Must be a valid Unix-style file permissions mask expressed in octal notation.
    permissions: {{ auditbeat_combined.logging.files.permissions }}
    {% endif %}
  {% endif %}

  {% if 'json' in auditbeat_combined.logging %}
  # Set to true to log messages in json format.
  json: {{ auditbeat_combined.logging.json }}
  {% endif %}
{% endif %}



#============================== Xpack Monitoring =====================================
#
# https://www.elastic.co/guide/en/beats/auditbeat/6.2/configuration-monitor.html
#
# beatname can export internal metrics to a central Elasticsearch monitoring cluster.
# This requires xpack monitoring to be enabled in Elasticsearch.
# The reporting is disabled by default.

# Set to true to enable the monitoring reporter.
#xpack.monitoring.enabled: false

# Uncomment to send the metrics to Elasticsearch. Most settings from the
# Elasticsearch output are accepted here as well. Any setting that is not set is
# automatically inherited from the Elasticsearch output configuration, so if you
# have the Elasticsearch output configured, you can simply uncomment the
# following line, and leave the rest commented out.
#xpack.monitoring.elasticsearch:

  # Array of hosts to connect to.
  # Scheme and port can be left out and will be set to the default (http and 9200)
  # In case you specify and additional path, the scheme is required: http://localhost:9200/path
  # IPv6 addresses should always be defined as: https://[2001:db8::1]:9200
  #hosts: ["localhost:9200"]

  # Set gzip compression level.
  #compression_level: 0

  # Optional protocol and basic auth credentials.
  #protocol: "https"
  #username: "beats_system"
  #password: "changeme"

  # Dictionary of HTTP parameters to pass within the url with index operations.
  #parameters:
    #param1: value1
    #param2: value2

  # Custom HTTP headers to add to each request
  #headers:
  #  X-My-Header: Contents of the header

  # Proxy server url
  #proxy_url: http://proxy:3128

  # The number of times a particular Elasticsearch index operation is attempted. If
  # the indexing operation doesn't succeed after this many retries, the events are
  # dropped. The default is 3.
  #max_retries: 3

  # The maximum number of events to bulk in a single Elasticsearch bulk API index request.
  # The default is 50.
  #bulk_max_size: 50

  # Configure http request timeout before failing an request to Elasticsearch.
  #timeout: 90

  # Use SSL settings for HTTPS.
  #ssl:
    #enabled: true

    # Configure SSL verification mode. If `none` is configured, all server hosts
    # and certificates will be accepted. In this mode, SSL based connections are
    # susceptible to man-in-the-middle attacks. Use only for testing. Default is
    # `full`.
    #verification_mode: full
  
    # List of supported/valid TLS versions. By default all TLS versions 1.0 up to
    # 1.2 are enabled.
    #supported_protocols: [TLSv1.0, TLSv1.1, TLSv1.2]
  
    # SSL configuration. By default is off.
    # List of root certificates for HTTPS server verifications
    #certificate_authorities: ["/etc/pki/root/ca.pem"]
  
    # Certificate for SSL client authentication
    #certificate: "/etc/pki/client/cert.pem"
  
    # Client Certificate Key
    #key: "/etc/pki/client/cert.key"
  
    # Optional passphrase for decrypting the Certificate Key.
    #key_passphrase: ''
  
    # Configure cipher suites to be used for SSL connections
    #cipher_suites: []
  
    # Configure curve types for ECDHE based cipher suites
    #curve_types: []
  
    # Configure what types of renegotiation are supported. Valid options are
    # never, once, and freely. Default is never.
    #renegotiation: never



#================================ HTTP Endpoint ======================================
# Each beat can expose internal metrics through a HTTP endpoint. For security
# reasons the endpoint is disabled by default. This feature is currently experimental.
# Stats can be access through http://localhost:5066/stats . For pretty JSON output
# append ?pretty to the URL.

# Defines if the HTTP endpoint is enabled.
#http.enabled: false

# The HTTP endpoint will bind to this hostname or IP address. It is recommended to use only localhost.
#http.host: localhost

# Port on which the HTTP endpoint will bind. Default is 5066.
#http.port: 5066
